a=""".............C.7..................G..0...y........
..................7................C..............
....................................0......W....y.
.......................................D..W.......
..........u.......................................
..................................4.......D0...j..
.....................................D............
................O.....C................G..........
............F.....................C...............
......u..........F.................4.......y......
..........X..........5....4...........1...........
..........F...........5X...................3......
.............F.............................j.3....
.................u..............X.................
............................7.....................
..................................................
..........................5.....j2.........4......
....d.....................y...................j1..
..................................................
............................Y.e...................
.................d...X...............J...........e
.............d....................................
..............................Y..............1....
.........................................Y........
......................W......8..f...J.........3...
.......w.............J............................
...................................U.....f......e.
.................................Of....e....t...1.
.......g..........d......s........................
................G................f................
.....................................O............
...g........................T.....U...............
......................s..........T.............G..
................................s.......8.........
.....9........g...........o...U............E......
............g............................t....o...
...........................................6....E.
.....................s......x........6....E.......
..........w.9................x............t.......
...........9........w...........J.....6o..........
.............................................o....
..........S................U......................
.......S..2..........c........T.O....t............
.....2...S.....c...................T..............
..................x.......................8.......
....9.............................................
...wS.....................................6.......
................2........................8........
..................................................
.................x....c........................E.."""
test="""......#....#
...#....0...
....#0....#.
..#....0....
....0....#..
.#....A.....
...#........
#......#....
........A...
.........A..
..........#.
..........#."""
#a=test
b=[[y for y in x] for x in a.splitlines()]
w,h = len(b[0]),len(b)

antennae = {}
for j,y in enumerate(b):
    for i,x in enumerate(y):
        if x not in ".#":
            antennae.setdefault(x,[]).append((i,j))

antennaPairs = set()
for freq in antennae.keys():
    freqAntennae = antennae[freq]
    for i, antenna1 in enumerate(freqAntennae):
        for j, antenna2 in enumerate(freqAntennae):
            if (antenna2,antenna1) in antennaPairs or i == j:
                continue
            antennaPairs.add((antenna1,antenna2))

antinodes=set()
for antenna1, antenna2 in antennaPairs:
    x1,y1 = antenna1
    x2,y2 = antenna2
    dx,dy = x2-x1, y2-y1
    antinodes = antinodes.union({(x1-dx,y1-dy),(x2+dx,y2+dy)})
            
print(len([(x,y) for (x,y) in antinodes if 0<=x<w and 0<=y<h]))#p1

antinodes=set()
for antenna1, antenna2 in antennaPairs:
            x1,y1 = antenna1
            x2,y2 = antenna2
            dx,dy = x2-x1,y2-y1
            antinodes = antinodes.union({antenna1,antenna2})
            nx,ny = x2+dx,y2+dy
            while 0<=nx<w and 0<=ny<h:
                antinodes.add((nx,ny))
                nx,ny = nx+dx,ny+dy
            nx,ny = x1-dx,y1-dy
            while 0<=nx<w and 0<=ny<h:
                antinodes.add((nx,ny))
                nx,ny = nx-dx,ny-dy

print(len([(x,y) for (x,y) in antinodes if 0<=x<w and 0<=y<h]))#p2
