a="""...................................................................................................................................
.#..#.......#....#.......#.#.....#......#..#.#.........#..............#............#......#........#...##........#..#.....#........
..#......#.###....#........#..#....##..#................#................#...........#..........##.#.#....#....#.....#....#...##.#.
.......#....#..#..#...#........#.....#.............##.....#.............#.#.........##......##.#.......#...#...#...........#.##.##.
....#...#......#.#.##.....#.#..##..#..........#.#..##.....................#............#....##............#......#.........#....#..
......#...#..##...#...#.....#......##.#......#..##.#..##.....................#.......##......##.......##.......#..#.....#.....#....
.#...#...#....#.......#..#.#...##.....#..#..##.....#........................#....#............#....#.....#.....#.#...#...........#.
..#..........#..###............#...###.##..#..#....##.........#...................##.#.......#......#......#.........#.............
..................#.#.#...#..#..#..#.#............##............................#......................###...#.....##.........#....
............#....................#...........#.....................#.#........#..#.....#...#...#......#.#.#...#.......#......##....
..##.#........#..#...#........#..#...#..#....#.#..................................#..#.............#..#.#..#....##...........##.#..
.....##.#......#..###.............#.#....##..................#......#..##...............#....#.....#..........#........#...........
...#.#.......##......##.#.###..##.........#.....#...................#...#................#.##....#..........#.#.......#.#......#...
.#..#.#.....#.....##...#.............#....#...............#...##..........#...............................#......#.....##..........
........#................#..##......#....###..#...........#.#.......#....#..................##...#.................#.#.....#...#...
..#..#......#.#.#.......................#.#...................#.....##.#..............#...........#....#.....#....#...##..#........
...#.#....#.##.......#..........#............#..............#.#.#.##........#.................#.#....#....##....#......#......#....
.#.....#...#.#.#.#......#.#.#......#.#.#............#....#........#........#............#.............#.#..###....#..##.....#......
..#.......#..#....#......#..#....#.................#....#.......#...#....#.....................#.##............##...............##.
.#...##.....#..#..#.....#............#.#..............#.......#.....#..#..#.#..#.........#.##....#...###..###.....#.....#.....##.#.
.....#.....#.#....##.#.....#.....#.....................##.....#.................#..............#.#..#.#......#.......#.....#.......
.....#.#.....#........................................##....#............#......#..............#..................#..##.#.......#..
.............#.#...##..............#....................#..........#..#...#.#.#..............#...#....##.....#.........#....#.##...
.......#.........#....###..............................#......##..........#....#................#....#.#.........#....#.......#....
..#...#....#.........#..............##...........#..#.#....#....#.##....#...........................#..............#....#....###...
.........###.......#...........#....#.........#..#...##...............#........#..##............#.#..#....#...#.#.......#......##..
....#.....##..#................#........................#......#.....#...#.....##..............#......#..###.......#.......#.#.#...
..##.#.....#..................................##.....#...##.....#.##.....#.#.......................#....#....##..........#.....#...
...#.#..#.......#.......#.#...##..................#.##....#....#........#.#......#.#...#...........#......#....#.#..#.....#.#....#.
.#......#........#.#.#.......#...........#....#....#.....#....##............#.....................#...............#....#...#.#.....
...##..............###.#....#..#........#..#..#.......#.##.....#.....#..#......#...##..##............#....##......#.#.##...#.......
........#...#............##............##......#..###.......................##..#.#.....#...........#.#.#.......#.#........#.#.#...
.............##........#....##.................##..#..............................#.#.....#..#...................#...............#.
....#....#.....#.......##.###..........#...##.....##...#........#...................#....#.##.............#.#....#.#.....#.....#...
....#...##.......#...##.................#..##............##....##.....#...........#.#.#................#..#..#...#.............#...
....##...........#...####.........#.............#..##............................#....##.#...#...............#...#...#....#........
...................#...##............#....#.#....#..........#.#......###...................#.#...#........##......#....#.........#.
....#..#...#..##.....#..#.......#...#..#.........#.#..###...........#..#..##...#.......#.....#....#...................#.........#..
..#.........#....#..#.............#...#...#.........#...#..........#...#...#.....##........................#.......##...#........#.
...#.....#...#.....#.............##...........#..#.##....#.#..............###.#.##.....#..........##...............#....#...#..##..
..##..............#.#..........#..##.#.#.......#......##...#.#.....##....#....#.#....#......#.......#..............##.........#..#.
.......###.####................#...........##....#......##...#.............###...........#......#...#.#...........#.........#......
...#.#......#..#............#.#.....#......#...........#...............#.#.....#............#.......#....................#....#....
......#....#..................#...................##..........#....#.#.......................#...................##......#.#..#....
.....##........#..........#.....#.........#....##.....###..........#..#.....#....#.......#....#.....................#.......#......
.#......#...#.............#..............................##..#.#..##....#..............#.#......#............................#.....
......##.....................#..............##..#...................##....#............#...#...#..#..#...............##..........#.
.##.#..#.....#........##.......##.............##.......#.#..........#........##.....#..#.#........#..#.....##........#.#..#........
.#..###...............#...##........##......#.#..##..#....#.......##..#.....##.....#..........#.#..#....#.............#........#...
...#......##..........#..#..##.##.....#....#.#...............##.......#.#.............#.............##..#.#.............#........#.
............................#......#....#...##.......#..##.....#.............##...####..#.....#......#.#.##........................
........#.#.......#...#..#.....#.........#.......#...#....#...#...##...#...#........#..#..........##.#.............................
........................#..........#..#....##........#.........##...........##..........#.#.#.#...#.....#.#..............#...#..#..
...#..#..........##...#...###..............##......#...........##.##..#...#.......#....#......#...........#.#...............#......
...##...........#..........##...#..#.#.......#....#.#.#.......#.......#.....#........#.......#.......#.#........#............#.....
.#............#....##........#........####.#..##......#......#..#.......#........#...#....#......#....#.....#......#...............
.....#...........#..........#.....#..#..#...#...............#.......#.......#.#............#....#...#..............................
.#................#....#..............##...#....#...##.#..##.........................#................##.#........##...............
.#...........#..#.#.....##.........##..#.#.#....#....#......##..........#.....................#.....#.......##...##..............#.
.#........#.##.#..#.#...###.#..........#....#......#..............................#..#.#.##...#..#...#.....#...##...#...#..........
............#.#.....#.####......#......##...#.#.........#..#........#..........#....#.#..##.#.#.#..............#...#..#..#.......#.
........#..#..#.....#..#....#.##...................#...#....##..#.#..#...##..#...#...................#......#...#...#.##...........
.......#............##...#.#....#..#........#.........##...............#...#..#...........#..#...#.......#......#..........#.......
............#...........#.#....#....#..##.........#.#..#................#.#.#.......#..#.....##........................###.........
.....#..#...#.....#.#......#..##......#....##...#..#....#............#.........#......#.....#..#....#.##...........#.##............
.................................................................S.................................................................
........#...............#..........#.#.......##...#...#.......#.#..........#.#.....#.....##.......#.......#...#.......#..#.........
...........#.........#...#.............#......#..#.#.#.#...................#...#...#.......#...#........#.#........#....#...#......
.......##...........#................#...#..#..........#....#.#.#...###...#.............##..#....#.#...#.........#.......###.......
............#...........##..#........#....##.....#............#..........#...#....#..#.......##.......#...#...#......##..#.........
..........#....#.............#...#.....#....#.....#..#..#.......#....#..#.............#..#...........#..##...#....#.#.#............
..............#.......#.......#..#......#..............#...........#.##..###..####...#..................#.#..#..#..#.#..........##.
.#...........#...#.......#..#.....#.....#....##......#..........#..#..#.........#...#..#...........................................
...#...........#.#.#.....#.#.#...##..#...#.....#..........#.....#.......#.........#.....#.#...#.....#......#.........##.........#..
...................##.........#.....#..#...#.##...#..........##........#.................#...#..#....#.......#...............#.....
....................#..##.......#.......#......#..................#.#.....#...####.....#............#...#...#.###................#.
.......................#...#.....#.......#..#..#.......#..............#.....#.#....#..#..#...................#...............#.....
.....#...................#.......#.....##......#..#.#..#...............#...#............#.....#..........#.#..#...#.............#..
...................#.........#..........#.....##..#....#......#........#.....#....##.........#.........#....#..................#...
......#...............#.#.................#.#..##..#....##........#..........#...#...##......#..........#......#........#........#.
..#.#.......................#.....#.#..........####.................#.....#....#...##.#.....##.#...........................##......
.........#........................#...........#...#.##..................#.#.......##...#.#..#..............#...................#.#.
..##.#..#.#..........#..#..#..#....#...........##.#.....##.#..#.#.......................#...#.....#..#.................###..##.....
.#..#.#...............#..........................#.......##..#....#......#.....#...#....#.......#....##..#......................##.
.....#........#.............#..#.........#....#.#.#....##.......#.#.......#............................#..................#.##.#...
....#.##.#..............#......#..#....#...............#...###..........#.#......##.#...#.#.#.#.#........#.........#.....#....##...
.....#.#.#..#.............#..............#...#...#..##..#....#..#.....#.#.....#...#..........##..........#.............#..#..#.....
..#...#..##.....#............#..#.#......#..#....#....#.....................#.....#.................#.##.........#......#..........
.......#..#.##..#..#................##.................#..#........#........#...#.....#...........#.............#....#..........##.
.......#.......................#......#..........##...#.#......#..##........#.....#......#....#................##...#..............
.....#.....##....#............#.#........#............#.#......#.........#....#.............##..#..#...............#...#.#...##.##.
...#....#.##.........#..................#.........#......#.....##.###....#.#...#...#.##...#..................#.....#....#.#...#....
.....##.........#.....#...........#...........#.........#.........#.#..##.#.......##.........##............##.......#....#.........
....................#...........#........#.#....#........#.........#.....#...#...#....#..........#........#.#......#........#......
..............#..#................#.......#....#.#.........#......#.......#.....................................#.....##..#........
......#...#.#...#............................#........#..#...........................#...#.##..........................#.#.........
...........#..##.#...#...#.......................#..#.....................#.............#..#.............#.#.#..#.#..#.............
.......#............................#.....#.#..#.#..#.#..............#.............#..#....................#........#.......#....#.
.#...##..###.#..#....#.....#.#...............#.............#......#....#....#...#........#............#.##.....#....#...#........#.
.....##........#..#......#.#.##...........#............#.......#...#...#............#.....#.................#........#.#..#.#......
...#.....#.#..#......#.##.................#.#..#.......##.........................##...............#...#...#......#......##........
..#....#.......#.#...#....#..###.................#...#...#.##........#..#.#..#...#...#................#.....#.....#.#....#.##..##..
......#.....#.#.#.........................#..#.#...#...#................#....#...#...#..#.................#....##.......#.#..#.....
..#...........#.......#....................#.....#...#.#...............#.#....##...#...............#....#........#.#.##.##..#.#.#..
.#...#.............#..###.......#...........#.......................#....###..#..#..............#....#..#....#......##..#.#........
..................#.............#.................#.........##....##..#.............#...........#...............#...#........#.#...
..#.....###.#.#.....#.#.............#......................#....#.....#............#..............#..#...........#..............#..
.##......#..#..##.......#..##......#...............#...#.............#.##...#...............#........#...#..#.................#....
...#.#...##.#..#...##.#.#..........#...#.........#.#......#..#.......#........#..#...........#.................###.................
.......................##......#..............................#.........#....#..................#..#...#..#.......#.......##.......
....#...#.....#.............#...#.................#.#...#..........##....#..##.................#......#..#............##...........
.........#..........#......#.......#.......................##.##..............................#....##.........#.....###........#.#.
....#.#.#.............#.....#..............#........#.................#..#..............#...........#.....#........#..##...........
......##.#......#....#..#.......###.......#.............#.........#...#....#..#....................#.......#.##.#.##.....##....#...
..#.....#.....##..#.....#...#....#....#.#..............#.#....##.......#.#.#..........................#.#.#.#.##..........#..#.....
...............#.#.###.......###.#...........#........#...###............#..#.......#...##.......##...#........#...................
.....#.........#.#.#..............##.........##............##...#...#...................#..###..........#..#..#.#...#..#...........
........#......#........##.#.....#.#...#....#...#.............#.........#.#.......#.....#.......##...#....#.........#.....#..#.....
.##......#..........#......#............#.....................##...#..............#...............##.............##...#.#..........
...#..#..#.#..#......#.......##.......#.....#................#...................#............#.........#.........#.........##.##..
....#...#........##.#........#..#.#.....#.........................##.#.............#...#.#..........#..#...........................
.........#..#..#.....##.......##......#..#...#..............#....................##...#......##......#...#.#........##.............
..#....#..#..#.#......#......#...................#.##........#.#.....#.............##.....#.......................##...........#...
.#.#..#........#.....#..#...........#.##....................................#...........##..................#...........##.........
..........#..#.............#..#......#..##.##.....#...#.........#.............................#.#...#....................#.....#...
.#..........#..#.#.#.#..#..#..#....#..#.......#........##..................#..#.#....#......#.......#.##.......#.#......###........
............#........#....#..#.#...#..##..#..#..#........................#....##......##........#.....##.....#.......#.......###.#.
...#.#........................#......#..............#...............................#.#..#..###...................#.....#..........
..#....#.....#......#.#.....#..##......#..#..##.....#.....#.....................#............#..#...#.#..##....##..#...#.......#...
.#..#.................................#....#.....#.....................#...#...#.#.........#.#...#..#.....#...................#....
..................................................................................................................................."""
test="""...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
..........."""
test=""".................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
.................................
.................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##..S####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
.................................
.................................
.....###.#......###.#......###.#.
.###.##..#..###.##..#..###.##..#.
..#.#...#....#.#...#....#.#...#..
....#.#........#.#........#.#....
.##...####..##...####..##...####.
.##..#...#..##..#...#..##..#...#.
.......##.........##.........##..
.##.#.####..##.#.####..##.#.####.
.##..##.##..##..##.##..##..##.##.
................................."""
a=test
a.replace("S",".")
b=[x*9 for x in a.splitlines()]*9
w,h = len(b[0]),len(b)
start=(w//2,h//2)

def traverse(start):
    dirs=[[-1,0],[0,-1],[1,0],[0,1]]
    queue=[[start,0]]
    visited = {start}
    visitedSteps = {0:{start}}
    targetSteps = 1024
    while queue:
        pos, steps = queue.pop(0)
        x,y = pos
        if steps >= targetSteps:
            break
        for dx,dy in dirs:
            nx,ny = x+dx,y+dy
            if nx < 0 or ny < 0 or nx >= w or ny >= h:
                continue
            if b[ny][nx] == "#":
                continue
            if (nx,ny) in visited:
                continue
            visited.add((nx,ny))
            visitedSteps.setdefault(steps+1,set()).add((nx,ny))
            queue.append([(nx,ny), steps+1])
    return visitedSteps

visitedSteps = traverse(start)
total = 0
for x in visitedSteps:
    if x%2==0:
        total += len(visitedSteps[x])
print(total)

import matplotlib.pyplot as plt
import matplotlib.animation as animation

plt.ion()
fig, ax = plt.subplots()
c = [[{".": 0, "S": 0, "#": 1, "O": 2}[x] for x in y] for y in b]
cax = ax.matshow(c, cmap='viridis', vmin=0, vmax=2)

def update(i):
    d = [[x for x in y] for y in c]
    #step = visitedSteps[i]
    lsb = i % 2
    for j in range(lsb, i + 1, 2):
        for (x, y) in visitedSteps[j]:
            d[y][x] = 2
    cax.set_data(d)
    return cax,

ani = animation.FuncAnimation(fig, update, frames=len(visitedSteps), interval=64, blit=True)

plt.show()
input()